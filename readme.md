# üó∫Ô∏è Terrain Map Generator

This project allows you to generate detailed terrain maps with various geographical features like roads, rivers, buildings, and country boundaries. It fetches elevation data from Mapzen and geographical data from OpenStreetMap (OSM) to create visually rich maps. It generates a high-quality, print-ready file.

---

## üöÄ Getting Started

To run this project, you'll need Python and a few libraries.

### Prerequisites

Make sure you have Python 3.8 or newer installed. You can download it from [python.org](https://www.python.org/downloads/).

### Installation

1.  **Clone the repository** (if it's in a Git repository):
    ```bash
    git clone https://github.com/mdimitri/elevationAnalysis.git
    cd elevationAnalysis
    ```
    If not, just make sure both `getElevationRaster_mapzenWebMercator.py` and `makeMap_epsg4326.py` are in the same directory.

2.  **Install the required Python libraries**:
    Open your terminal or command prompt and run:
    ```bash
    pip install requests pillow numpy matplotlib geopandas pandas shapely rasterio pyproj tqdm scikit-image osm2geojson
    ```

---

## üìÇ Project Structure

* `getElevationRaster_mapzenWebMercator.py`: This script downloads elevation data from Mapzen (Terrarium tiles) for a specified geographical area and saves it as a `.npz` (Numpy compressed archive) file and a `.jpg` image.
* `makeMap_epsg4326.py`: This is the main script. It takes the elevation data generated by the first script, fetches various geographical features from OpenStreetMap, and then uses Matplotlib to render a detailed map. It can also cache fetched data to speed up subsequent runs.

---

## üèÉ How to Use

### Step 1: Get Elevation Data

First, you need to download the terrain heightmap for your desired area.

1.  Open `getElevationRaster_mapzenWebMercator.py`.
2.  In the `main()` function, adjust the `west`, `south`, `east`, and `north` variables to define your desired bounding box. These are latitude and longitude coordinates.
    ```python
    def main():
        # Example for North Macedonia
        west = 20.4529023 - 0.05
        south = 40.852478 - 0.05
        east = 23.034051 + 0.05
        north = 42.3739044 + 0.05

        output_dir = __import__("datetime").datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
        fetch_and_process_heightmap(west, south, east, north, zoom=12, output_dir=output_dir, max_workers=32)
        return
    ```
    You can also adjust the `zoom` level (higher zoom means more detail, but larger file sizes and longer download times) and `max_workers` for parallel downloads.
3.  Run the script:
    ```bash
    python getElevationRaster_mapzenWebMercator.py
    ```
    This will create a new directory (named with the current timestamp, e.g., `2025-08-14_16-17-43`) containing an `.npz` file and a `.jpg` image of the elevation data. Note down the path to the `.npz` file.

### Step 2: Generate the Map

Next, you'll use the elevation data to generate the feature-rich map.

1.  Open `makeMap_epsg4326.py`.
2.  In the `main()` function, update the `rasterPath` variable to point to the `.npz` file you just generated in Step 1.
    ```python
    def main():
        rasterPath = r"./2025-08-14_16-17-43/heightmap_z12_lon_20.3908_23.1151_lat_40.7807_42.4882_reslon_0.000343_reslat_0.000257.npz" # Replace with your .npz path
    ```
3.  You can also adjust the `resolutionFactor` and `dpi` to control the output image quality and size. Higher values mean better quality but longer rendering times.
    ```python
    # Example settings:
    resolutionFactor, dpi = 1.5, int(1500) # Good middle ground for hires
    ```
4.  Run the script:
    ```bash
    python makeMap_epsg4326.py
    ```
    This will download various geographic features (roads, rivers, places, etc.) from OSM (and cache them for future runs in the same directory as your `.npz` file) and then generate a detailed map image (`.png` file) in the same directory.

---

## ‚öôÔ∏è Customization

* **Geographical Area**: Modify `west`, `south`, `east`, `north` in `getElevationRaster_mapzenWebMercator.py`.
* **Zoom Level**: Adjust `zoom` in `getElevationRaster_mapzenWebMercator.py` (ranges typically from 0 to 15, with higher numbers being more detailed).
* **Map Features**: The `makeMap_epsg4326.py` script fetches many types of features. You can explore the `get_*_from_osm` functions and `plot_relief_with_features` to see what's included and how it's styled. You can also comment out specific `load_or_fetch` calls if you don't want certain features.
* **Styling**: Experiment with the `cmap`, `gamma`, `road_styles`, font sizes (`settlementsFontSize`, `airportsFontSize`, etc.), and marker sizes in `makeMap_epsg4326.py` to change the map's appearance.
* **Terrain Exaggeration**: The `exagerateTerrain` boolean in `makeMap_epsg4326.py` can be toggled to enhance or flatten the visual representation of terrain height differences.
* **Caching**: The `load_or_fetch` function automatically caches fetched OSM data as `.pkl` files, making subsequent runs faster if the bounding box doesn't change.

---

## üôã‚Äç‚ôÇÔ∏è Contributing

Feel free to fork this project, open issues, or submit pull requests with improvements!

---

## üìÑ License

### MIT License

Copyright (c) [Year] [Your Name or Project Name]

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

---

## üôè Acknowledgements

* **Mapzen Terrarium**: For providing global elevation data.
* **OpenStreetMap (OSM)**: For the rich geographical feature data.
* **Matplotlib**: For plotting and visualization.
* **GeoPandas, Shapely, rasterio, pyproj, osm2geojson**: For geospatial data handling.